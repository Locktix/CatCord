{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\iamacat\\\\Documents\\\\GitHub\\\\CatzCord\\\\src\\\\components\\\\DMPanel.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from \"react\";\nimport { auth, db } from \"../firebase\";\nimport { collection, query, orderBy, onSnapshot, addDoc, serverTimestamp, doc, getDoc } from \"firebase/firestore\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function DMPanel({\n  dmId,\n  onBack\n}) {\n  _s();\n  const user = auth.currentUser;\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const [otherUser, setOtherUser] = useState(null);\n  const messagesEndRef = useRef(null);\n  useEffect(() => {\n    if (!dmId) return;\n    const q = query(collection(db, \"privateConversations\", dmId, \"messages\"), orderBy(\"createdAt\"));\n    const unsub = onSnapshot(q, snap => {\n      setMessages(snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      })));\n    });\n    return () => unsub();\n  }, [dmId]);\n  useEffect(() => {\n    if (!dmId || !user) return;\n    const fetchOtherUser = async () => {\n      const convSnap = await getDoc(doc(db, \"privateConversations\", dmId));\n      if (!convSnap.exists()) return;\n      const members = convSnap.data().members;\n      const otherUid = members.find(uid => uid !== user.uid);\n      if (!otherUid) return;\n      const userSnap = await getDoc(doc(db, \"users\", otherUid));\n      setOtherUser(userSnap.exists() ? {\n        uid: otherUid,\n        ...userSnap.data()\n      } : {\n        uid: otherUid\n      });\n    };\n    fetchOtherUser();\n  }, [dmId, user]);\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  const handleSend = async e => {\n    e.preventDefault();\n    if (!input.trim()) return;\n    await addDoc(collection(db, \"privateConversations\", dmId, \"messages\"), {\n      text: input,\n      author: user.uid,\n      createdAt: serverTimestamp()\n    });\n    setInput(\"\");\n  };\n  if (!dmId) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex-1 h-screen flex flex-col bg-gray-900 bg-opacity-60 min-w-0\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-6 py-4 border-b border-gray-800 text-lg font-bold flex items-center gap-3 bg-gray-900 bg-opacity-80\",\n      children: [onBack && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onBack,\n        className: \"mr-2 text-purple-300 hover:text-white\",\n        children: \"\\u2190\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 11\n      }, this), otherUser && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: otherUser.avatar || `https://api.dicebear.com/7.x/thumbs/svg?seed=${otherUser.uid}`,\n          alt: \"avatar\",\n          className: \"w-8 h-8 rounded-full object-cover border-2 border-indigo-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [\"DM avec \", otherUser.pseudo ? `${otherUser.pseudo}${otherUser.discriminator ? '#' + otherUser.discriminator : ''}` : otherUser.uid]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-y-auto px-6 py-4 space-y-2\",\n      children: [messages.map(msg => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `flex ${msg.author === user.uid ? 'justify-end' : 'justify-start'}`,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `px-4 py-2 rounded-lg max-w-xs break-words ${msg.author === user.uid ? 'bg-indigo-600 text-white' : 'bg-gray-800 text-purple-100'}`,\n          children: msg.text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 13\n        }, this)\n      }, msg.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: messagesEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSend,\n      className: \"flex gap-2 p-4 border-t border-gray-800 bg-gray-900 bg-opacity-80\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        className: \"flex-1 px-3 py-2 rounded bg-gray-800 text-white border border-gray-700 focus:outline-none\",\n        placeholder: \"\\xC9crire un message...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded text-white font-semibold\",\n        children: \"Envoyer\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 5\n  }, this);\n}\n_s(DMPanel, \"W4ctUo40kuLEikal/+IoOok1mLo=\");\n_c = DMPanel;\nvar _c;\n$RefreshReg$(_c, \"DMPanel\");","map":{"version":3,"names":["React","useEffect","useState","useRef","auth","db","collection","query","orderBy","onSnapshot","addDoc","serverTimestamp","doc","getDoc","jsxDEV","_jsxDEV","Fragment","_Fragment","DMPanel","dmId","onBack","_s","user","currentUser","messages","setMessages","input","setInput","otherUser","setOtherUser","messagesEndRef","q","unsub","snap","docs","map","id","data","fetchOtherUser","convSnap","exists","members","otherUid","find","uid","userSnap","_messagesEndRef$curre","current","scrollIntoView","behavior","handleSend","e","preventDefault","trim","text","author","createdAt","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","src","avatar","alt","pseudo","discriminator","msg","ref","onSubmit","type","value","onChange","target","placeholder","_c","$RefreshReg$"],"sources":["C:/Users/iamacat/Documents/GitHub/CatzCord/src/components/DMPanel.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport { auth, db } from \"../firebase\";\r\nimport { collection, query, orderBy, onSnapshot, addDoc, serverTimestamp, doc, getDoc } from \"firebase/firestore\";\r\n\r\nexport default function DMPanel({ dmId, onBack }) {\r\n  const user = auth.currentUser;\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [otherUser, setOtherUser] = useState(null);\r\n  const messagesEndRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!dmId) return;\r\n    const q = query(collection(db, \"privateConversations\", dmId, \"messages\"), orderBy(\"createdAt\"));\r\n    const unsub = onSnapshot(q, snap => {\r\n      setMessages(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n    });\r\n    return () => unsub();\r\n  }, [dmId]);\r\n\r\n  useEffect(() => {\r\n    if (!dmId || !user) return;\r\n    const fetchOtherUser = async () => {\r\n      const convSnap = await getDoc(doc(db, \"privateConversations\", dmId));\r\n      if (!convSnap.exists()) return;\r\n      const members = convSnap.data().members;\r\n      const otherUid = members.find(uid => uid !== user.uid);\r\n      if (!otherUid) return;\r\n      const userSnap = await getDoc(doc(db, \"users\", otherUid));\r\n      setOtherUser(userSnap.exists() ? { uid: otherUid, ...userSnap.data() } : { uid: otherUid });\r\n    };\r\n    fetchOtherUser();\r\n  }, [dmId, user]);\r\n\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  const handleSend = async (e) => {\r\n    e.preventDefault();\r\n    if (!input.trim()) return;\r\n    await addDoc(collection(db, \"privateConversations\", dmId, \"messages\"), {\r\n      text: input,\r\n      author: user.uid,\r\n      createdAt: serverTimestamp(),\r\n    });\r\n    setInput(\"\");\r\n  };\r\n\r\n  if (!dmId) return null;\r\n\r\n  return (\r\n    <div className=\"flex-1 h-screen flex flex-col bg-gray-900 bg-opacity-60 min-w-0\">\r\n      <div className=\"px-6 py-4 border-b border-gray-800 text-lg font-bold flex items-center gap-3 bg-gray-900 bg-opacity-80\">\r\n        {onBack && (\r\n          <button onClick={onBack} className=\"mr-2 text-purple-300 hover:text-white\">‚Üê</button>\r\n        )}\r\n        {otherUser && (\r\n          <>\r\n            <img src={otherUser.avatar || `https://api.dicebear.com/7.x/thumbs/svg?seed=${otherUser.uid}`} alt=\"avatar\" className=\"w-8 h-8 rounded-full object-cover border-2 border-indigo-500\" />\r\n            <span>DM avec {otherUser.pseudo ? `${otherUser.pseudo}${otherUser.discriminator ? '#' + otherUser.discriminator : ''}` : otherUser.uid}</span>\r\n          </>\r\n        )}\r\n      </div>\r\n      <div className=\"flex-1 overflow-y-auto px-6 py-4 space-y-2\">\r\n        {messages.map(msg => (\r\n          <div key={msg.id} className={`flex ${msg.author === user.uid ? 'justify-end' : 'justify-start'}`}>\r\n            <div className={`px-4 py-2 rounded-lg max-w-xs break-words ${msg.author === user.uid ? 'bg-indigo-600 text-white' : 'bg-gray-800 text-purple-100'}`}>\r\n              {msg.text}\r\n            </div>\r\n          </div>\r\n        ))}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n      <form onSubmit={handleSend} className=\"flex gap-2 p-4 border-t border-gray-800 bg-gray-900 bg-opacity-80\">\r\n        <input\r\n          type=\"text\"\r\n          value={input}\r\n          onChange={e => setInput(e.target.value)}\r\n          className=\"flex-1 px-3 py-2 rounded bg-gray-800 text-white border border-gray-700 focus:outline-none\"\r\n          placeholder=\"√âcrire un message...\"\r\n        />\r\n        <button type=\"submit\" className=\"bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded text-white font-semibold\">Envoyer</button>\r\n      </form>\r\n    </div>\r\n  );\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}